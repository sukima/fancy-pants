/**********************************************\
*  FancyPants — customElements micro-lib   O   *
*  MIT — Copyright © 2023 Devin Weaver    /|\  *
*  https://fancy-pants.js.org/   v3.0.1   </>  *
\**********************************************/
import{Tracked,Cache,setScheduleRerender}from"./tracking.js";import{scheduleRender,registerRenderer,unregisterRenderer}from"./rendering.js";setScheduleRerender(scheduleRender);const RENDER=Symbol("memoized render");const templates=new Map;const dasherize=e=>e.replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase();const findClosest=(e,t)=>e.closest(`#${t}`)??e.closest(t);const yieldableProxy=e=>new Proxy(e,{get:(e,t)=>{if(typeof t!=="string")return;return findClosest(e,dasherize(t))?.yields?.()}});function makeTemplateElement({template:e,shadow:t}){if(e===null&&t===null){return null}let r=document.createElement("template");if(e){r.innerHTML=e}else if(t){r.innerHTML=t;r.dataset.shadow=true}return r}function appendWithSlotableContent(e,t){e.querySelectorAll("[slot]").forEach((e=>{let r=e.getAttribute("slot");t.querySelector(`slot[name="${r}"]`)?.after(e)}));t.querySelector("slot:not([name])")?.after(...e.childNodes);t.querySelectorAll("slot").forEach((e=>e.remove()));e.append(t)}function componentOf(e){class t extends e{#e=false;constructor(){super();this[RENDER]=Cache.memoize((()=>this.render(yieldableProxy(this))))}connectedCallback(){if(!this.#e){let e=templates.get(this.tagName.toLowerCase());if(e){if(e.dataset.shadow===undefined){appendWithSlotableContent(this,e.content.cloneNode(true))}else{this.shadow=this.attachShadow({mode:"open"});this.shadow.appendChild(e.content.cloneNode(true))}}this.track();registerRenderer(this[RENDER]);this.#e=true}scheduleRender()}disconnectedCallback(){unregisterRenderer(this[RENDER])}attributeChangedCallback(e){Tracked.for(this,e).dirty()}getAttribute(e){Tracked.for(this,e).consume();return super.getAttribute(e)}hasAttribute(e){Tracked.for(this,e).consume();return super.hasAttribute(e)}track(){Tracked.activate(this);return this}render(){}yields(){return this}static register(e,t=document){let r;if(typeof e==="string"){r=()=>t.querySelector(e)}else if(e instanceof Element){r=()=>e}else{let e=t.querySelector(`template#${this.tagName}`);r=()=>e??makeTemplateElement(this)}templates.set(this.tagName,r());customElements.define(this.tagName,this)}static get tagName(){return dasherize(this.name)}static get shadow(){return null}static get template(){return null}}return t}export default componentOf(HTMLElement);export{componentOf};
