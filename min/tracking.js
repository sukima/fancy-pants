/**********************************************\
*  FancyPants — customElements micro-lib   O   *
*  MIT — Copyright © 2021 Devin Weaver    /|\  *
*  https://fancy-pants.js.org/   v3.0.0   </>  *
\**********************************************/
let $REVISION=0;let CURRENT_TRACKER=null;let scheduleRerender=()=>{};const TRACKABLES=new WeakMap;export class Tracked{revision=$REVISION;#e;constructor(e){this.#e=e}get value(){this.consume();return this.#e}set value(e){if(this.#e===e)return;this.#e=e;this.dirty()}dirty(){this.revision=++$REVISION;scheduleRerender()}consume(){CURRENT_TRACKER?.add(this)}static for(e,t,r=(()=>{})){let n=TRACKABLES.get(e)??new Map;let i=n.get(t)??new Tracked(r());n.set(t,i);TRACKABLES.set(e,n);return i}static proxy(e={}){return new Proxy(e,{get(e,t){Tracked.for(e,t).consume();return Reflect.get(...arguments)},set(e,t){Tracked.for(e,t).dirty();return Reflect.set(...arguments)}})}static defineProperty(e,t,r=new Tracked){Object.defineProperty(e,t,{get(){return r.value},set(e){r.value=e}})}static activate(e){for(let t of Reflect.ownKeys(e)){let{value:r}=Reflect.getOwnPropertyDescriptor(e,t);if(r instanceof Tracked){Tracked.defineProperty(e,t,r)}}return e}}export class Cache{#t;#r=-1;#n=[];constructor(e){this.valueFn=e}execute(...e){if(this.revision>this.#r){let{valueFn:t}=this;let r=new Set;let n=CURRENT_TRACKER;setCurrentTracker(r);try{this.#t=t(...e)}finally{setCurrentTracker(n);this.#n=Array.from(r);this.#r=this.revision}}CURRENT_TRACKER?.add(this);return this.#t}get value(){return this.execute()}get revision(){return Math.max(...this.#n.map((e=>e.revision)),0)}static memoize(e){let t=new Cache(e);return function e(...r){return t.execute(...r)}}}export function setCurrentTracker(e){CURRENT_TRACKER=e}export function setScheduleRerender(e){scheduleRerender=e}export function memoizeFunction(e){return Cache.memoize(e)}export function tracked(e){return new Tracked(e)}export function activateTracking(e){return Tracked.activate(e)}
